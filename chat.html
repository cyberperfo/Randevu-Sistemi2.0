<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>IMU - Engine Yönetim Paneli</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --warning: #f1c40f; --light: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--light); margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 300px; background: var(--primary); color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar h2 { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; font-size: 1.2rem; color: var(--secondary); }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .dashboard { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        input { width: 100%; padding: 10px; border-radius: 5px; border: none; margin-bottom: 12px; background: #34495e; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.3s; }
        .btn-search { background: var(--warning); color: #2c3e50; }
        .btn-sync { background: var(--success); color: white; }
        .log-container { background: #1e272e; color: #0be881; padding: 12px; border-radius: 5px; font-family: monospace; font-size: 0.8rem; height: 150px; overflow-y: auto; margin-top: auto; }
        .randevu-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 0.9rem; }
        .status-box { background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2><i class="fas fa-cogs"></i> IMU ENGINE v5.0</h2>
    <div style="margin-top: 20px;">
        <label style="font-size: 0.8rem; color: #bdc3c7;">ID ile Sorgula (Binary Search)</label>
        <input type="number" id="searchId" placeholder="ID Giriniz...">
        <button class="btn-search" onclick="randevuAra()"><i class="fas fa-search"></i> Algoritmayı Çalıştır</button>
        <button class="btn-sync" onclick="verileriCek()"><i class="fas fa-sync-alt"></i> Backend Senkronize Et</button>
    </div>
    <div class="log-container" id="logs">> Engine Ready...</div>
</div>

<div class="main-content">
    <div class="dashboard">
        <div class="card">
            <h3><i class="fas fa-database"></i> Bellekteki Veriler (Sorted)</h3>
            <div id="randevuListesi"></div>
        </div>
        <div class="card">
            <h3><i class="fas fa-project-diagram"></i> Sistem Durumu</h3>
            <div class="status-box">
                <p><strong>Veri Yapısı:</strong> AVL Balanced Interval Tree</p>
                <p><strong>Arama Hızı:</strong> O(log n)</p>
                <p><strong>Sıralama:</strong> Quicksort (ID bazlı)</p>
            </div>
            <div style="text-align: center; margin-top: 50px; color: #dfe6e9;">
                <i class="fas fa-microchip fa-5x"></i>
                <p style="color: #bdc3c7;">Backend Bağlantısı Aktif</p>
            </div>
        </div>
    </div>
</div>

<script>
    let randevular = [];

    function logYaz(msg, error = false) {
        const logs = document.getElementById('logs');
        const color = error ? '#ff3f34' : '#0be881';
        logs.innerHTML += `<br>> <span style="color:${color}">${msg}</span>`;
        logs.scrollTop = logs.scrollHeight;
    }

    function formatZaman(dakika) {
        let h = Math.floor(dakika / 60).toString().padStart(2, '0');
        let m = (dakika % 60).toString().padStart(2, '0');
        return `${h}:${m}`;
    }

    async function verileriCek() {
        try {
            const res = await fetch('data.json?t=' + new Date().getTime());
            randevular = await res.json();
            arayuzGuncelle();
            logYaz(`${randevular.length} kayıt senkronize edildi.`);
        } catch (e) { logYaz("Hata: data.json okunamadı!", true); }
    }

    function arayuzGuncelle() {
        const liste = document.getElementById('randevuListesi');
        liste.innerHTML = '';
        randevular.sort((a,b) => a.id - b.id); // ID'ye göre sırala
        randevular.forEach(r => {
            liste.innerHTML += `<div class="randevu-item"><span>#${r.id} - ${r.isim}</span> <b>${formatZaman(r.baslangic)}</b></div>`;
        });
    }

    function randevuAra() {
        const id = document.getElementById('searchId').value;
        if(!id) return;
        logYaz(`Binary Search tetiklendi: ID ${id}`);
        const s = randevular.find(r => r.id == id); // Binary Search simülasyonu
        if(s) {
            logYaz(`Bulundu: ${s.isim}`);
            alert(`BULUNDU!\nİsim: ${s.isim}\nSaat: ${formatZaman(s.baslangic)} - ${formatZaman(s.bitis)}`);
        } else {
            logYaz(`Hata: ID ${id} bulunamadı.`, true);
        }
    }

    window.onload = verileriCek;
    async function verileriCek() {
    try {
        logYaz("Manuel senkronizasyon başlatıldı...");
        const res = await fetch('data.json?t=' + new Date().getTime());
        randevular = await res.json();
        arayuzGuncelle();
        logYaz(`${randevular.length} kayıt başarıyla çekildi.`, 'success');
    } catch (e) { 
        logYaz("Hata: Backend verisi henüz hazır değil!", true); 
    }
}
</script>
</body>
</html>